using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace DemoApp
{
    public partial class FormMain : Form
    {
        public FormMain()
        {
            InitializeComponent();

            ITileServer[] tileServers = new ITileServer[]
            {               
                new OpenStreetMapTileServer(),
                new StamenTerrainTileServer(),
                new OpenTopoMapServer(),
                new OfflineTileServer(),
            };

            cmbTileServers.Items.AddRange(tileServers);
            cmbTileServers.SelectedIndex = 0;
            
            mapControl.ZoomLevel = 5;
            mapControl.Center = new GeoPoint(44.0f, 56.33333f);           
            mapControl.Points.Add(new GeoPoint(44.0f, 56.33333f));

            string trackPoints =
                            @"
41.016416,-65.351067
43.199197,-57.340782
44.219062,-53.346624
44.941861,-50.368631
45.518714,-47.879982
46.003496,-45.694137
46.422917,-43.719184
46.792549,-41.901906
47.122431,-40.208186
47.419498,-38.614685
47.688769,-37.104555
47.934033,-35.665225
48.158231,-34.287002
48.363700,-32.962236
48.552339,-31.684768
48.725713,-30.449566
48.885137,-29.252420
49.031728,-28.089844
49.166437,-26.958818
49.290093,-25.856801
49.403421,-24.781568
49.507057,-23.731188
49.601566,-22.703964
49.687450,-21.698409
49.765160,-20.713175
49.835110,-19.747101
49.897662,-18.799104
49.953157,-17.868241
50.001902,-16.953644
50.044180,-16.054527
50.080251,-15.170179
50.110352,-14.299937
50.134713,-13.443219
50.153534,-12.599458
50.167015,-11.768159
50.175328,-10.948844
50.178649,-10.141076
50.177134,-9.344456
50.170933,-8.558605
50.160187,-7.783165
50.145024,-7.017811
50.125578,-6.262230
50.101960,-5.516129
50.074292,-4.779237
50.042671,-4.051289
50.007205,-3.332041
49.967990,-2.621262
49.925120,-1.918725
49.878682,-1.224221
49.828758,-0.537547
49.775436,0.141485
49.718786,0.813065
49.658891,1.477368
49.595812,2.134564
49.529624,2.784818
49.460390,3.428284
49.388176,4.065118
49.313040,4.695463
49.235042,5.319465
49.154234,5.937261
49.070678,6.548984
48.984417,7.154765
48.895511,7.754728
48.803999,8.349000
48.709933,8.937699
48.613356,9.520944
48.514314,10.098848
48.412846,10.671526
48.308995,11.239086
48.202798,11.801635
48.094289,12.359282
47.983514,12.912129
47.870497,13.460280
47.755282,14.003834
47.637893,14.542891
47.518364,15.077550
47.396727,15.607906
47.273010,16.134055
47.147242,16.656091
47.019449,17.174108
46.889658,17.688198
46.757892,18.198452
46.624173,18.704960
46.488531,19.207814
46.350981,19.707101
46.211551,20.202911
46.070254,20.695330
45.927112,21.184448
45.782146,21.670350
45.635371,22.153124
45.486806,22.632855
45.336467,23.109630
45.184364,23.583536
45.030518,24.054657
44.874937,24.523078
44.717639,24.988887
44.558631,25.452166
44.397927,25.913004
44.235536,26.371487
44.071468,26.827698
43.905730,27.281724
43.738333,27.733653
43.569281,28.183571
43.398584,28.631565
43.226244,29.077724
43.052267,29.522133
42.876656,29.964884
42.699414,30.406064
42.520546,30.845766
42.340051,31.284081
42.157929,31.721099
41.974181,32.156915
41.788807,32.591621
41.601801,33.025315
41.413164,33.458090
41.222889,33.890049
41.030972,34.321287
40.837409,34.751908
40.642190,35.182011
40.445311,35.611707
40.246760,36.041097
40.046529,36.470294
39.844604,36.899406
39.640974,37.328547
39.435626,37.757832
39.228546,38.187384
39.019714,38.617322
38.809117,39.047773
38.596735,39.478863
38.382545,39.910728
38.166528,40.343503
37.948658,40.777325
37.728911,41.212345
37.507261,41.648710
37.283676,42.086575
37.058125,42.526105
36.830577,42.967462
36.600995,43.410822
36.369339,43.856366
36.135573,44.304281
35.899651,44.754768
35.661524,45.208027
35.421148,45.664281
35.178466,46.123749
34.933422,46.586668
34.685956,47.053293
34.436004,47.523889
34.183495,47.998722
33.928356,48.478097
33.670505,48.962327
33.409858,49.451736
33.146323,49.946679
32.879798,50.447537
32.610179,50.954706
32.337348,51.468619
32.061179,51.989744
31.781535,52.518582
31.498271,53.055661
31.211221,53.601576
30.920212,54.156961
30.625048,54.722514
30.325516,55.298989
30.021383,55.887228
29.712390,56.488140
29.398246,57.102761
29.078628,57.732225
28.753178,58.377805
28.421486,59.040930
28.083094,59.723230
27.737468,60.426561
27.384007,61.153048
27.022008,61.905162
26.650646,62.685796
26.268953,63.498362
25.875765,64.346951
25.469674,65.236543
25.048939,66.173261
24.611376,67.164831
24.154173,68.221215
23.673603,69.355644
23.164546,70.586307
22.619626,71.939503
22.027510,73.455714
21.369054,75.203536
20.606712,77.317840
19.642072,80.153293
17.549304,87.059551
";


string polygonPoints =
@"38.010171,81.451617
38.893957,88.812845
39.249550,92.505004
39.478347,95.329902
39.639564,97.697905
39.756753,99.771391
39.842183,101.634402
39.903224,103.337218
39.944722,104.912692
39.970076,106.383734
39.981773,107.767086
39.981711,109.075363
39.971371,110.318427
39.951943,111.504125
39.924391,112.638816
39.889519,113.727767
39.848004,114.775380
39.800419,115.785386
39.747264,116.760974
39.688963,117.704912
39.625893,118.619604
39.558388,119.507162
39.486735,120.369460
39.411203,121.208154
39.332027,122.024731
39.249412,122.820527
39.163557,123.596754
39.074634,124.354505
38.982800,125.094770
38.888206,125.818464
38.790982,126.526431
38.691251,127.219428
38.589127,127.898170
38.484719,128.563312
38.378122,129.215463
38.269427,129.855194
38.158718,130.483030
38.046078,131.099463
37.931579,131.704960
37.815288,132.299951
37.697276,132.884848
37.577596,133.460033
37.456317,134.025866
37.333481,134.582693
37.209147,135.130837
37.083362,135.670606
36.956172,136.202292
36.827618,136.726170
36.697742,137.242508
36.566584,137.751555
36.434181,138.253550
36.300567,138.748725
36.165776,139.237299
36.029841,139.719480
35.892788,140.195473
35.754648,140.665468
35.615450,141.129655
35.475219,141.588206
35.333980,142.041301
35.191755,142.489100
35.048566,142.931764
34.904437,143.369448
34.759389,143.802301
34.613440,144.230466
34.466609,144.654083
34.318915,145.073287
34.170372,145.488211
34.021000,145.898978
33.870812,146.305714
33.719825,146.708537
33.568052,147.107565
33.415507,147.502912
33.262202,147.894686
33.108151,148.282996
32.953364,148.667947
32.797852,149.049641
32.641629,149.428178
32.484702,149.803656
32.327080,150.176171
32.168777,150.545816
32.009798,150.912682
31.850150,151.276860
31.689844,151.638438
31.528888,151.997503
31.367287,152.354139
31.205047,152.708431
31.042177,153.060459
30.878680,153.410306
30.714563,153.758051
30.549833,154.103773
30.384491,154.447549
30.218546,154.789457
30.051998,155.129571
29.884854,155.467966
29.717115,155.804718
29.548787,156.139899
29.379869,156.473581
29.210367,156.805838
29.040283,157.136740
28.869617,157.466358
28.698373,157.794765
28.526551,158.122029
28.354154,158.448222
28.181180,158.773412
28.007632,159.097670
27.833507,159.421064
27.658810,159.743665
27.483536,160.065542
27.307686,160.386765
27.131261,160.707403
26.954258,161.027524
26.776673,161.347201
26.598511,161.666504
26.419763,161.985502
26.240431,162.304267
26.060512,162.622870
25.880000,162.941383
25.698894,163.259881
25.517191,163.578433
25.334885,163.897116
25.151973,164.216006
24.968451,164.535177
24.784315,164.854704
24.599556,165.174670
24.414171,165.495150
24.228154,165.816228
24.041500,166.137981
23.854198,166.460495
23.666244,166.783857
23.477630,167.108148
23.288349,167.433462
23.098389,167.759884
22.907745,168.087511
22.716405,168.416436
22.524359,168.746754
22.331601,169.078564
22.138114,169.411972
21.943890,169.747081
21.748914,170.083998
21.553177,170.422835
21.356664,170.763707
21.159359,171.106732
20.961250,171.452031
20.762320,171.799734
20.562552,172.149971
20.361930,172.502878
20.160436,172.858595
19.958049,173.217271
19.754750,173.579057
19.550519,173.944116
19.345332,174.312610
19.139164,174.684717
18.931994,175.060614
18.723793,175.440497
18.514534,175.824560
18.304187,176.213014
18.092721,176.606084
17.880104,177.003997
17.666300,177.407005
17.451272,177.815362
17.234980,178.229346
17.017382,178.649246
16.798434,179.075370
16.578087,179.508052
16.356289,179.947640
16.132986,-179.605486
15.908120,-179.150929
15.681624,-178.688257
15.453433,-178.216999
15.223471,-177.736660
14.991657,-177.246693
14.757906,-176.746513
14.522123,-176.235481
14.284202,-175.712893
14.044033,-175.177989
13.801489,-174.629922
13.556434,-174.067776
13.308714,-173.490505
13.058163,-172.896982
12.804588,-172.285913
12.547779,-171.655862
12.287492,-171.005194
12.023457,-170.332054
11.755360,-169.634311
11.482836,-168.909489
11.205467,-168.154720
10.922752,-167.366584
10.634101,-166.541043
10.338797,-165.673168
10.035963,-164.756924
9.724500,-163.784732
9.403005,-162.746893
9.069633,-161.630618
8.721873,-160.418460
8.356151,-159.085512
7.967068,-157.594055
7.545725,-155.881764
7.075368,-153.830919
6.515713,-151.157646
5.666943,-146.448716
5.686196,-143.205243
6.786818,-149.687501
7.404934,-152.768397
7.901153,-154.996673
8.338048,-156.813786
8.737876,-158.376281
9.111643,-159.761340
9.465762,-161.013800
9.804349,-162.162385
10.130251,-163.226877
10.445518,-164.221517
10.751698,-165.157011
11.049987,-166.041614
11.341336,-166.881878
11.626513,-167.683083
11.906153,-168.449586
12.180783,-169.184987
12.450853,-169.892361
12.716741,-170.574303
12.978781,-171.233058
13.237258,-171.870591
13.492424,-172.488593
13.744502,-173.088586
13.993689,-173.671895
14.240159,-174.239712
14.484074,-174.793111
14.725573,-175.333054
14.964786,-175.860407
15.201830,-176.375966
15.436814,-176.880453
15.669832,-177.374523
15.900976,-177.858782
16.130327,-178.333794
16.357964,-178.800074
16.583954,-179.258094
16.808364,-179.708304
17.031256,179.848890
17.252683,179.413097
17.472700,178.983962
17.691357,178.561144
17.908698,178.144329
18.124767,177.733217
18.339603,177.327530
18.553246,176.926999
18.765731,176.531378
18.977091,176.140426
19.187360,175.753918
19.396565,175.371647
19.604737,174.993398
19.811901,174.618986
20.018082,174.248225
20.223306,173.880934
20.427594,173.516948
20.630969,173.156101
20.833450,172.798242
21.035058,172.443217
21.235811,172.090886
21.435724,171.741109
21.634817,171.393752
21.833105,171.048688
22.030602,170.705792
22.227325,170.364945
22.423284,170.026026
22.618494,169.688926
22.812968,169.353536
23.006715,169.019747
23.199750,168.687458
23.392080,168.356565
23.583717,168.026972
23.774670,167.698585
23.964948,167.371305
24.154560,167.045046
24.343513,166.719715
24.531815,166.395226
24.719475,166.071494
24.906498,165.748432
25.092892,165.425956
25.278661,165.103991
25.463812,164.782450
25.648351,164.461258
25.832280,164.140332
26.015608,163.819603
26.198336,163.498988
26.380469,163.178416
26.562010,162.857810
26.742963,162.537098
26.923331,162.216205
27.103117,161.895061
27.282322,161.573593
27.460950,161.251728
27.639001,160.929396
27.816478,160.606524
27.993380,160.283044
28.169710,159.958885
28.345469,159.633975
28.520654,159.308243
28.695269,158.981621
28.869312,158.654037
29.042780,158.325418
29.215676,157.995696
29.387997,157.664800
29.559741,157.332656
29.730909,156.999195
29.901496,156.664342
30.071499,156.328026
30.240919,155.990172
30.409750,155.650708
30.577990,155.309558
30.745635,154.966646
30.912682,154.621898
31.079124,154.275235
31.244959,153.926579
31.410181,153.575852
31.574785,153.222973
31.738764,152.867861
31.902114,152.510434
32.064829,152.150607
32.226899,151.788296
32.388320,151.423413
32.549081,151.055871
32.709177,150.685580
32.868597,150.312447
33.027335,149.936379
33.185380,149.557281
33.342722,149.175055
33.499350,148.789601
33.655254,148.400818
33.810421,148.008599
33.964841,147.612838
34.118499,147.213426
34.271384,146.810249
34.423481,146.403192
34.574775,145.992134
34.725251,145.576955
34.874896,145.157527
35.023689,144.733721
35.171613,144.305403
35.318651,143.872434
35.464786,143.434670
35.609993,142.991967
35.754255,142.544169
35.897547,142.091121
36.039846,141.632657
36.181131,141.168606
36.321373,140.698797
36.460548,140.223037
36.598624,139.741145
36.735576,139.252917
36.871369,138.758150
37.005973,138.256624
37.139354,137.748113
37.271474,137.232386
37.402297,136.709190
37.531781,136.178271
37.659886,135.639355
37.786564,135.092158
37.911771,134.536377
38.035455,133.971696
38.157561,133.397781
38.278042,132.814277
38.396827,132.220814
38.513859,131.616992
38.629071,131.002389
38.742388,130.376558
38.853737,129.739016
38.963030,129.089258
39.070182,128.426733
39.175100,127.750851
39.277683,127.060984
39.377817,126.356446
39.475384,125.636501
39.570260,124.900346
39.662303,124.147111
39.751355,123.375843
39.837260,122.585504
39.919829,121.774948
39.998859,120.942910
40.074132,120.087984
40.145396,119.208607
40.212379,118.303025
40.274766,117.369266
40.332207,116.405092
40.384306,115.407933
40.430606,114.374859
40.470574,113.302451
40.503593,112.186703
40.528937,111.022858
40.545736,109.805211
40.552929,108.526814
40.549213,107.179043
40.532950,105.750979
40.502011,104.228428
40.453574,102.592392
40.383716,100.816399
40.286711,98.861578
40.153571,96.666509
39.968585,94.123332
39.698890,91.005187
39.243502,86.610753
38.345625,79.193225";

            var track = new List<GeoPoint>();
            var stringTrackPoints = trackPoints.Split('\n').Where(p => !string.IsNullOrWhiteSpace(p)).Select(p => p.Split(','));

            var polygon = new List<GeoPoint>();
            var stringPolygonPoints = polygonPoints.Split('\n').Where(p => !string.IsNullOrWhiteSpace(p)).Select(p => p.Split(','));

            foreach (var sp in stringTrackPoints)
            {
                float lon = float.Parse(sp[1], CultureInfo.InvariantCulture);
                float lat = float.Parse(sp[0], CultureInfo.InvariantCulture);

                track.Add(new GeoPoint(lon, lat));
            }

            foreach (var sp in stringPolygonPoints)
            {
                float lon = float.Parse(sp[1], CultureInfo.InvariantCulture);
                float lat = float.Parse(sp[0], CultureInfo.InvariantCulture);

                polygon.Add(new GeoPoint(lon, lat));
            }

            mapControl.Tracks.Add(track);
            mapControl.Polygons.Add(polygon);
        }

        private void mapControl_MouseMove(object sender, MouseEventArgs e)
        {
            GeoPoint g = mapControl.Mouse;
            this.Text = $"Longitude = {g.Longitude} / Latitude = {g.Latitude} / Zoom = {mapControl.ZoomLevel}";
        }

        private void mapControl_Paint(object sender, PaintEventArgs e)
        {
           
        }

        private void btnClearCache_Click(object sender, EventArgs e)
        {
            mapControl.ClearCache(true);
            ActiveControl = mapControl;
        }

        private void cmbTileServers_SelectedIndexChanged(object sender, EventArgs e)
        {
            mapControl.TileServer = cmbTileServers.SelectedItem as ITileServer;
            ActiveControl = mapControl;
        }

        private void mapControl1_Paint(object sender, PaintEventArgs e)
        {

        }

        private void mapControl1_MouseMove(object sender, MouseEventArgs e)
        {

        }
    }
}
